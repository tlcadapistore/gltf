"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[857],{3547:(e,t,r)=>{r.r(t),r.d(t,{PLYLoader:()=>g});var s,a,t=r(2718),n=r(5433),i=r(5081),h=r(6017),d=r(604),c=r(1695),p=r(428),o=r(4207),u=r(4735),f=r(1201);(a=s=s||{})[a.HEADER=0]="HEADER",a[a.HEADER_VERTEX=1]="HEADER_VERTEX",a[a.HEADER_FACE=2]="HEADER_FACE",a[a.DONE=3]="DONE";const x={x:{semantic:u.p.POSITION,componentIndex:0},y:{semantic:u.p.POSITION,componentIndex:1},z:{semantic:u.p.POSITION,componentIndex:2},nx:{semantic:u.p.NORMAL,componentIndex:0},ny:{semantic:u.p.NORMAL,componentIndex:1},nz:{semantic:u.p.NORMAL,componentIndex:2},s:{semantic:u.p.TEXCOORD_0,componentIndex:0},t:{semantic:u.p.TEXCOORD_0,componentIndex:1}},_={float:f.g.FLOAT};class l{constructor(){this._state=s.HEADER,this._parser={[s.HEADER]:this.parseHeader,[s.HEADER_VERTEX]:this.parseHeaderVertex,[s.HEADER_FACE]:this.parseHeaderFace,[s.DONE]:this.parseHeaderDone},this._structure={binary:!1,vertexCount:0,faceCount:0,vertexProperties:[]}}parse(e){this._state=s.HEADER;var t=e.split("\n");for(const e of t)this.parseLine(e);return this._structure}parseLine(e){e=o.M.trim(e),this._parser[this._state].call(this,e)}parseHeader(e){var t;0===e.indexOf("element vertex")?(this._state=s.HEADER_VERTEX,this._structure.vertexCount=parseInt(e.split("element vertex ")[1],10)):0===e.indexOf("element face")?(this._state=s.HEADER_FACE,this._structure.faceCount=parseInt(e.split("element face ")[1],10)):0===e.indexOf("format")?(t=e.split(" ")[1],this._structure.binary="ascii"!==t):this.checkHeaderEnd(e)}parseHeaderVertex(e){var t,r;0===e.indexOf("property")?(t=(r=o.M.splitByWhiteSpace(e))[1],r=r[2],x[r]&&_.hasOwnProperty(t)?this._structure.vertexProperties.push({key:r,componentType:_[t]}):console.warn("Vertex property not found: "+e)):this.parseHeader(e)}parseHeaderFace(e){this.checkHeaderEnd(e)}checkHeaderEnd(e){0===e.indexOf("end_header")&&(this._state=s.DONE)}parseHeaderDone(e){e&&console.warn("This should be never reached, probably more than the header string was passed to PLYHeaderParser.")}}var v=r(6407),y=r(3829),m=r(5216);class A{constructor(){this._dataView=new DataView(new ArrayBuffer(0)),this._vertexArrays={},this._indexArray=[],this._highestIndex=0,this._offset=0}parse(r,t){var s,a;this._indexArray=[],this._highestIndex=0,this._offset=0,this._dataView=new DataView(t);for(const t of r.vertexProperties){const r=null==(s=x[t.key])?void 0:s.semantic;r&&!this._vertexArrays[r]&&(this._vertexArrays[r]=[])}v.M.sum(r.vertexProperties,e=>y._Z[e.componentType]);for(let e=0;e<r.vertexCount;++e)for(let e=0;e<r.vertexProperties.length;++e){const s=r.vertexProperties[e],n=null==(a=x[s.key])?void 0:a.semantic,i=this._vertexArrays[n];if(s&&i){r.vertexProperties.length;const t=this.readFloat32();i.push(t)}}this._indexArray=[];for(let e=0;e<r.faceCount;++e){const r=this.readUint8(),t=h.B.loopMap(0,r,e=>this.readUint32()),s=t[0];for(let e=2;e<r;++e){const r=t[e-1],o=t[e];this.addIndex(s),this.addIndex(r),this.addIndex(o)}}return new d.Z({buffers:Object.keys(this._vertexArrays).map(t=>new c.t({buffer:new p.f({data:new Float32Array(this._vertexArrays[t])}),attributes:[{semantic:t,size:v.M.sum(r.vertexProperties,e=>{return t===(null==(e=x[e.key])?void 0:e.semantic)?1:0})}]})),indexBuffer:0<this._indexArray.length?m.Y.fromData(new Uint32Array(this._indexArray)):void 0})}readUint32(){var e=this._dataView.getUint32(this._offset,!0);return this._offset+=4,e}readFloat32(){var e=this._dataView.getFloat32(this._offset,!0);return this._offset+=4,e}readUint8(){var e=this._dataView.getUint8(this._offset);return this._offset+=1,e}addIndex(e){this._indexArray.push(e),this._highestIndex=Math.max(e,this._highestIndex)}}class E{constructor(){this._structure={binary:!1,vertexCount:0,faceCount:0,vertexProperties:[]},this._currentVertexCount=0,this._currentNormal=[],this._vertexArrays={},this._indexArray=[],this._highestIndex=0}parse(e,t){var r;for(const t of(this._structure=e).vertexProperties){const e=null==(r=x[t.key])?void 0:r.semantic;e&&!this._vertexArrays[e]&&(this._vertexArrays[e]=[])}for(const e of t.split("\n"))this.parseLine(e);return new d.Z({buffers:Object.keys(this._vertexArrays).map(t=>new c.t({buffer:new p.f({data:new Float32Array(this._vertexArrays[t])}),attributes:[{semantic:t,size:v.M.sum(e.vertexProperties,e=>{return t===(null==(e=x[e.key])?void 0:e.semantic)?1:0})}]})),indexBuffer:0<this._indexArray.length?m.Y.fromData(new Uint32Array(this._indexArray)):void 0})}parseLine(e){(e=o.M.trim(e))&&(this._currentVertexCount<this._structure.vertexCount?this.parseVertex(e):this.parseFace(e))}parseVertex(e){var t=o.M.splitByWhiteSpace(e);if(t.length){for(let e=0;e<this._structure.vertexProperties.length;++e){var r=this._structure.vertexProperties[e],s=null==(s=x[r.key])?void 0:s.semantic,a=this._vertexArrays[s];if(r&&a){const s=parseFloat(t[e]);a.push(s)}}this._currentVertexCount++}}parseFace(t){if(t){var r=o.M.splitByWhiteSpace(t),s=parseInt(r[0]);if(v.M.isPositiveOrZero(s)){const t=parseInt(r[1]);for(let e=2;e<s;++e){var a=parseInt(r[e]),n=parseInt(r[e+1]);this.addIndex(t),this.addIndex(a),this.addIndex(n)}}}}addIndex(e){this._indexArray.push(e),this._highestIndex=Math.max(e,this._highestIndex)}parseVector(e,t,r){var e=(e=o.M.trim(e)).split(/\s+/),s=Number(e[0]),a=Number(e[1]),e=Number(e[2]);-1===r?t.push(s,a,e):(t[r]=s,t[r+1]=a,t[r+2]=e)}}var w=r(4955),I=r(2263),H=r(6646);class g extends t.a{static findHeaderEnd(e){var t=new DataView(e);let r=0;for(let e=0;e<t.byteLength;e++)if(String.fromCharCode(t.getUint8(e))==="\nend_header\n"[r]?r++:r=0,12===r)return e+1;console.warn("PLYBinaryParser header_end not found!")}constructor(e){super(e)}async loadFile(e,t){this._scene.name=e.name;var e=await n.P.readAsArraybuffer(e),{header:r,firstContentByte:s}=this.parseHeaderString(e),e=(void 0===s&&console.warn("PLYLoader: No content found in file!"),e.slice(s||0)),s=(new l).parse(r),r=s.binary?(new A).parse(s,e):(new E).parse(s,i.W.arraybuffer2string(e)),s=new w.B({renderNodes:[new I.j({geometry:r,material:new H.q({baseColorFactor:13421772,metallicFactor:.4,roughnessFactor:1})})]});return this._scene.add(s),this}parseHeaderString(e){var t=g.findHeaderEnd(e),e=new DataView(e,0,t);return{header:i.W.arraybuffer2string(e),firstContentByte:t}}}}}]);