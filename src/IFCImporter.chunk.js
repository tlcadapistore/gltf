"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[297],{2853:(e,t,s)=>{s.r(t),s.d(t,{IFCImporter:()=>r});var t=s(2718),i=s(5433),a=s(2263),o=s(6646),n=s(604),l=s(428),c=s(1695),h=s(4735),d=s(1201),m=s(5216),g=s(4955),p=s(9959),f=s(3629),w=s(9866);class _{static load(e,t,r){new _(e,t,r)}constructor(e,t,r){this._materials=new Map,this._geometries=new Map,this._api=e,this._modelId=e.OpenModel(t,{}),this._scene=r,this.importScene(),this._api.CloseModel(this._modelId)}importScene(){var t=this._api.LoadAllGeometry(this._modelId);for(let e=0;e<t.size();e++){var r=t.get(e);0<r.geometries.size()&&this.importMesh(r)}}importMesh(t){for(let e=0;e<t.geometries.size();e++){var r,s=t.geometries.get(e),i=this.getGeometry(s.geometryExpressID);i&&(r=new Float32Array(s.flatTransformation),r=new g.B({transform:p.j.fromMatrix(r),renderNodes:[new a.j({material:this.getMaterial(s.color),geometry:i})]}),this._scene.add(r))}}getGeometry(e){var t=this._geometries.get(e);if(void 0!==t)return t;var t=this._api.GetGeometry(this._modelId,e),r=this._api.GetVertexArray(t.GetVertexData(),t.GetVertexDataSize()),t=this._api.GetIndexArray(t.GetIndexData(),t.GetIndexDataSize());let s=null;return 0<r.length&&0<t.length?s=new n.Z({buffers:[new c.t({buffer:new l.f({data:r}),attributes:[{semantic:h.p.POSITION,size:3,componentType:d.g.FLOAT},{semantic:h.p.NORMAL,size:3,componentType:d.g.FLOAT}]})],indexBuffer:m.Y.fromData(t)}):console.warn("Empty mesh"),this._geometries.set(e,s),s}getMaterial(e){const t=f.I.vec4_to_hex([e.x,e.y,e.z,e.w]).toString(16),r=this._materials.get(t);if(r)return r;{const r=f.I.vec3_to_hex([e.x,e.y,e.z]),s=new o.q({baseColorFactor:r,baseColorAlpha:e.w,metallicFactor:.1,roughnessFactor:.7,side:w.N.DOUBLE});return this._materials.set(t,s),s}}}class r extends t.a{constructor(e){super({})}async loadFile(e,t){var r=await this.getModule(),e=await i.P.readAsArraybuffer(e);return _.load(r,new Uint8Array(e),this._scene),this}async getModule(){return this._webIFC||(this._webIFC=new Promise(async e=>{var t=null==(t=Object.getOwnPropertyDescriptor(self,"crossOriginIsolated"))?void 0:t.get,r=(Object.defineProperty(self,"crossOriginIsolated",{get:function(){return!1}}),await s.e(240).then(s.bind(s,1240)))["IfcAPI"],r=new r;await r.Init(),Object.defineProperty(self,"crossOriginIsolated",{get:t}),e(r)}),await this._webIFC)}}}}]);